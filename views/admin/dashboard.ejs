<%-include("partials/header") %>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center mb-4">Admin Dashboard</h2>

        <!-- Filters for Sales Reports -->
        <div class="d-flex justify-content-between mb-3">
            <h4>Sales Reports</h4>
            <input type="hidden" id="salesData" value='<%= JSON.stringify(salesData) %>'>

            <select id="salesFilter" class="form-select w-auto">
                <option value="yearly">Yearly</option>
                <option value="monthly">Monthly</option>
                <option value="weekly">Weekly</option>
                <option value="daily">Daily</option>
            </select>
        </div>

        <!-- Sales Chart -->
        <canvas id="salesChart" height="100"></canvas>

        <!-- Best Selling Sections -->
        <div class="row mt-4">
            <div class="col-md-4">
                <h5>Best Selling Products</h5>
                <ul class="list-group">
                    <% bestSellingProducts.forEach(product => { %>
                        <li class="list-group-item">
                            <%= product.name %> - Sold: <%= product.totalSold %>
                        </li>
                    <% }) %>
                </ul>
            </div>
            <div class="col-md-4">
                <h5>Best Selling Categories</h5>
                <ul class="list-group">
                    <% bestSellingCategories.forEach(category => { %>
                        <li class="list-group-item">
                            <%= category.name %> - Sold: <%= category.totalSold %>
                        </li>
                    <% }) %>
                </ul>
            </div>
            <div class="col-md-4">
                <h5>Best Selling Brands</h5>
                <ul class="list-group">
                    <% bestSellingBrands.forEach(brand => { %>
                        <li class="list-group-item">
                            <%= brand.name %> - Sold: <%= brand.totalSold %>
                        </li>
                    <% }) %>
                </ul>
            </div>
        </div>>

        <!-- Ledger Book (Optional) -->
        <div class="mt-5">
            <h4>Ledger Book</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody id="ledgerTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const ctx = document.getElementById("salesChart").getContext("2d");
            let salesChart;
    
            function renderChart(labels, values) {
                if (salesChart) {
                    salesChart.destroy();
                }
                salesChart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Total Orders",
                            data: values,
                            backgroundColor: "rgba(54, 162, 235, 0.6)"
                        }]
                    },
                    options: { responsive: true, scales: { y: { beginAtZero: true } } }
                });
            }
    
            // ✅ Load Default Monthly Chart on Page Load
            const defaultLabels = '<%- JSON.stringify(salesData.salesLabels) %>';
            const defaultValues = '<%- JSON.stringify(salesData.salesValues) %>';
            renderChart(defaultLabels, defaultValues);
    
            // ✅ Update Chart When Filter Changes
            document.getElementById("salesFilter").addEventListener("change", function () {
                fetch(`/admin/api/sales-data?filter=${this.value}`)
                    .then(response => response.json())
                    .then(data => renderChart(data.salesLabels, data.salesValues))
                    .catch(error => console.error("Error loading sales chart:", error));
            });
        });
    </script>
    
    
    
    
</body>
</html>
