<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StrideX User Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex items-center justify-center h-screen bg-gray-900" style="background-color: #6f8e80;">
    <div class="flex w-4/5 max-w-5xl bg-gray-800 rounded-lg shadow-lg overflow-hidden">
        <!-- Left Section (Logo) -->
        <div class="w-1/2 flex items-center justify-center p-10 bg-gray-700" style="background-color: #8FB0A1;">
            <img src="/admin/imgs/logos/logo-png.png" alt="StrideX Logo" style="width: 900px;" class="w-3/4">
        </div>
        
        <!-- Right Section (Login Form) -->
        <div class="w-1/2 p-10 flex flex-col justify-center text-white" style="background-color: #8FB0A1;">
            <h2 class="text-3xl font-bold mb-6 text-center" style="color: rgb(251, 223, 223);">StrideX User Login</h2>
            <form action="/user/login" method="POST" id="signinForm">
                <div class="mb-4">
                    <input type="email" id="emailField"  name="email" value="<%= typeof email !== 'undefined' ? email: '' %>" 
                        placeholder="Email" class="w-full px-4 py-3 rounded-md bg-gray-600 text-white placeholder-gray-400">
                </div>
                <div class="mb-4">
                    <input type="password" id="passwordField" name="password" placeholder="Password" 
                        class="w-full px-4 py-3 rounded-md bg-gray-600 text-white placeholder-gray-400">
                    <div class="text-right mt-2">
                        <a href="#" id="forgotPasswordLink" class="text-blue-400 hover:text-blue-300 text-sm">Forgot Password?</a>
                    </div>
                </div>
                <button type="submit" id="loginButton" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-md">Login Now</button>
            </form>
            <hr class="my-6 border-gray-600">
            <p class="text-center mb-4">Login with Others</p>
            <button onclick="window.location.href='/user/auth/google'"
                class="w-full flex items-center justify-center bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-md mb-3">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5 mr-2" 
                    alt="Google Logo"> Login with Google
            </button>
            <button class="w-full flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-md">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" class="w-5 h-5 mr-2" 
                    alt="Facebook Logo"> Login with Facebook
            </button>

            <!-- Sign Up Button -->
            <p class="text-center mt-4 text-white">Don't have an account? <a href="/user/signup" class="text-blue-500 font-semibold">Sign Up Here</a></p>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex justify-center items-center">
        <div class="bg-white p-6 rounded-lg shadow-lg w-96">
            <h2 class="text-xl font-semibold text-center mb-4">Reset Password</h2>
            <p class="text-sm text-gray-600 mb-4 text-center">Enter your email to receive a OTP</p>
            <input type="email" id="forgotEmail" placeholder="Enter your email"
                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
            <button id="sendResetEmail" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 mt-4 rounded-md">
                Send OTP
            </button>
            <button id="closeModal" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 mt-2 rounded-md">
                Cancel
            </button>
        </div>
    </div>

    <!-- SweetAlert2 CSS & JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <% if (messages && messages.error && messages.error.length > 0) { %>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                Swal.fire({
                    icon: "error",
                    title: "<%= messages.error[0] %>",
                    showConfirmButton: true
                });
            });
        </script>
    <% } %>
    
    <% if (messages && messages.success && messages.success.length > 0) { %>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                Swal.fire({
                    icon: "success",
                    title: "<%= messages.success[0] %>",
                    showConfirmButton: true
                });
            });
        </script>
    <% } %>

    <script>
     document.addEventListener("DOMContentLoaded", function () {
    const forgotPasswordModal = document.getElementById("forgotPasswordModal");
    const forgotPasswordLink = document.getElementById("forgotPasswordLink");
    const closeModalBtn = document.getElementById("closeModal");
    const sendResetEmailBtn = document.getElementById("sendResetEmail");
    const loginButton=document.getElementById("loginButton");

    // Show Modal When Clicking "Forgot Password?"
    forgotPasswordLink.addEventListener("click", function (event) {
        event.preventDefault();
        forgotPasswordModal.classList.remove("hidden");
    });

    // Hide Modal When Clicking "Cancel"
    closeModalBtn.addEventListener("click", function () {
        forgotPasswordModal.classList.add("hidden");
    });

    loginButton.addEventListener("click", async function (event) {
    event.preventDefault(); // Prevent form submission

    const email = document.getElementById("emailField").value;
    const password = document.getElementById("passwordField").value;

    if (!email || !password) {
        Swal.fire({
            icon: "error",
            title: "Missing Fields!",
            text: "Please enter both email and password."
        });
        return;
    }

    try {
        const response = await fetch("/user/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        const data = await response.json();
        console.log(data);

        if (data.status === "success") {
            Swal.fire({
                icon: "success",
                title: "Login successful!",
                text: data.message
            }).then(() => {
                window.location.href = data.redirectUrl;
            });
        } else {
            Swal.fire({
                icon: "error",
                title: "Login failed!",
                text: data.message
            });
        }
    } catch (error) {
        console.error("Error logging in:", error);
        Swal.fire({
            icon: "error",
            title: "Something went wrong!",
            text: "Please try again later."
        });
    }
});


    // Handle "Send OTP" Button Click
    sendResetEmailBtn.addEventListener("click", async function () {
        const email = document.getElementById("forgotEmail").value;
        localStorage.setItem("userEmail", email);

        if (!email) {
            Swal.fire({ icon: "error", title: "Please enter your email!" });
            return;
        }

        try {
            const response = await fetch("/user/forgot-password", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email })
            });

            const data = await response.json();

            if (data.status === "success") {
                Swal.fire({
                    icon: "success",
                    title: "OTP sent successfully!",
                    text: "Please check your email for the OTP."
                }).then(() => {
                    window.location.href = data.redirectUrl; // Redirect only on success
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: data.message || "Failed to send OTP!",
                    text: "Please check your email and try again."
                });
            }

        } catch (error) {
            console.error("Error sending OTP:", error);
            Swal.fire({
                icon: "error",
                title: "Something went wrong!",
                text: "Please try again later."
            });
        }
    });
});

    </script>
</body>
</html>
